<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caisse 2025 ‚Äì Hedo</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- SheetJS pour l'import/export Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- FileSaver pour l'export de fichiers -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <!-- Papa Parse pour CSV -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Caisse 2025 ‚Äì Hedo</h1>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard" id="tab-dashboard">
                <i class="fas fa-chart-line"></i> Tableau de bord
            </button>
            <button class="nav-tab" data-tab="events" id="tab-events">
                <i class="fas fa-calendar-alt"></i> √âv√©nements
            </button>
            <button class="nav-tab" data-tab="import" id="tab-import">
                <i class="fas fa-upload"></i> Importer
            </button>
            <button class="nav-tab" data-tab="export" id="tab-export">
                <i class="fas fa-download"></i> Exporter
            </button>
        </nav>

        <!-- Tableau de bord -->
        <div class="tab-content active" id="content-dashboard">
            <section class="content-section">
                <h2 class="section-title">R√©sum√© annuel</h2>
                <div class="year-selector">
                    <label for="year-select">Ann√©e :</label>
                    <select id="year-select">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                <div class="stats-grid" id="stats-grid">
                    <!-- Les statistiques seront inject√©es ici -->
                </div>
            </section>

            <section class="content-section">
                <h2 class="section-title">Par trimestre</h2>
                <div class="quarters-grid" id="quarters-grid">
                    <!-- Les donn√©es par trimestre seront inject√©es ici -->
                </div>
            </section>
        </div>

        <!-- Gestion des √©v√©nements -->
        <div class="tab-content" id="content-events">
            <section class="content-section">
                <h2 class="section-title">Gestion des √©v√©nements</h2>
                
                <div class="filters-section">
                    <div class="filter-group">
                        <label for="filter-year">Ann√©e :</label>
                        <select id="filter-year">
                            <option value="">Toutes</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-quarter">Trimestre :</label>
                        <select id="filter-quarter">
                            <option value="">Tous</option>
                            <option value="Q1">Q1</option>
                            <option value="Q2">Q2</option>
                            <option value="Q3">Q3</option>
                            <option value="Q4">Q4</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="sort-by">Trier par :</label>
                        <select id="sort-by">
                            <option value="date-desc">Date (r√©cent)</option>
                            <option value="date-asc">Date (ancien)</option>
                            <option value="nom-asc">Nom (A-Z)</option>
                            <option value="nom-desc">Nom (Z-A)</option>
                            <option value="ca-desc">CA (√©lev√©)</option>
                            <option value="ca-asc">CA (faible)</option>
                            <option value="participants-desc">Participants (√©lev√©)</option>
                            <option value="participants-asc">Participants (faible)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addEvent()">
                        <i class="fas fa-plus"></i> Ajouter un √©v√©nement
                    </button>
                </div>

                <div class="events-container">
                    <div class="view-toggle">
                        <button class="btn btn-small" id="toggle-view" onclick="toggleEventView()">
                            <i class="fas fa-expand"></i> Vue d√©taill√©e
                        </button>
                    </div>
                    
                    <!-- Vue simple -->
                    <table class="events-table" id="events-table-simple">
                        <thead>
                            <tr>
                                <th>√âv√©nement</th>
                                <th title="Couples">üë´</th>
                                <th title="Hommes">üë®</th>
                                <th title="Femmes">üë©</th>
                                <th title="Cartes Membre">üé´</th>
                                <th title="Nourriture">üçΩÔ∏è</th>
                                <th>Entr√©es<br><small>(Cash+Carte+Cr√©dit)</small></th>
                                <th>Recharges<br><small>(Cash+Cr√©dit)</small></th>
                                <th>Total CA<br><small>(sans nourriture)</small></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="events-tbody-simple">
                            <!-- Les √©v√©nements seront inject√©s ici -->
                        </tbody>
                    </table>
                    
                    <!-- Vue d√©taill√©e -->
                    <div class="events-detailed-view" id="events-detailed-view" style="display: none;">
                        <div id="detailed-events-container">
                            <!-- Les √©v√©nements d√©taill√©s seront inject√©s ici -->
                        </div>
                    </div>
                    
                    <div class="no-data" id="no-events" style="display: none;">
                        Aucun √©v√©nement trouv√©.
                    </div>
                </div>
            </section>
        </div>

        <!-- Import -->
        <div class="tab-content" id="content-import">
            <section class="content-section">
                <h2 class="section-title">Importer des donn√©es</h2>
                <p>Importez vos donn√©es depuis un fichier CSV ou Excel. Les colonnes requises sont : nom, date, participants, ca_ht, tva, ca_ttc.</p>
                
                <div class="import-buttons">
                    <div class="import-btn" onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-file-csv icon"></i>
                        Importer CSV/Excel
                    </div>
                    <div class="import-btn" onclick="document.getElementById('files-input-multiple').click()">
                        <i class="fas fa-files icon"></i>
                        Import Multiple
                    </div>
                </div>
                
                <input type="file" id="file-input" accept=".csv,.xlsx,.xls" style="display: none;" onchange="handleFileImport(event)">
                <input type="file" id="files-input-multiple" accept=".csv,.xlsx,.xls" multiple style="display: none;" onchange="handleMultipleFileImport(event)">
                
                <div class="drop-zone" id="drop-zone">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
                    Glissez-d√©posez vos fichiers ici ou cliquez pour s√©lectionner
                </div>

                <div id="import-preview" class="content-section" style="display: none;">
                    <h3>Pr√©visualisation des donn√©es</h3>
                    <div id="preview-table-container"></div>
                    <div class="import-actions">
                        <button class="btn btn-primary" onclick="confirmImport()">Confirmer l'import</button>
                        <button class="btn btn-secondary" onclick="cancelImport()">Annuler</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Export -->
        <div class="tab-content" id="content-export">
            <section class="content-section">
                <h2 class="section-title">Exporter des donn√©es</h2>
                
                <div class="export-options">
                    <div class="export-group">
                        <h3>Export Personnalis√© pour Comptable</h3>
                        <div class="export-config">
                            <div class="export-filters">
                                <div class="filter-row">
                                    <div class="filter-group">
                                        <label>P√©riode :</label>
                                        <select id="export-period">
                                            <option value="all">Toute la p√©riode</option>
                                            <option value="year">Ann√©e compl√®te</option>
                                            <option value="quarter">Par trimestre</option>
                                            <option value="custom">P√©riode personnalis√©e</option>
                                        </select>
                                    </div>
                                    <div class="filter-group" id="export-year-group">
                                        <label>Ann√©e :</label>
                                        <select id="export-year">
                                            <option value="2025">2025</option>
                                            <option value="2024">2024</option>
                                            <option value="2023">2023</option>
                                        </select>
                                    </div>
                                    <div class="filter-group" id="export-quarter-group" style="display: none;">
                                        <label>Trimestre :</label>
                                        <select id="export-quarter">
                                            <option value="Q1">Q1</option>
                                            <option value="Q2">Q2</option>
                                            <option value="Q3">Q3</option>
                                            <option value="Q4">Q4</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="filter-row" id="custom-dates" style="display: none;">
                                    <div class="filter-group">
                                        <label>Du :</label>
                                        <input type="date" id="export-date-start">
                                    </div>
                                    <div class="filter-group">
                                        <label>Au :</label>
                                        <input type="date" id="export-date-end">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="export-columns">
                                <h4>Colonnes √† exporter :</h4>
                                <div class="columns-grid">
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-nom" checked> Nom √©v√©nement
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-date" checked> Date
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-trimestre" checked> Trimestre
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-type-soiree" checked> Type Soir√©e
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-couples" checked> Couples
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-hommes" checked> Hommes
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-femmes" checked> Femmes
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-cartes" checked> Cartes Membre
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-cash-entrees"> Cash Entr√©es
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-carte-entrees"> Carte Entr√©es
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-bc-entrees"> Cr√©dit Entr√©es
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-total-entrees" checked> Total Entr√©es
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-cash-recharges"> Cash Recharges
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-bc-recharges"> Cr√©dit Recharges
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-total-recharges" checked> Total Recharges
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-nourriture"> Nourriture
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-ca-ht" checked> CA HT
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-tva" checked> TVA
                                    </label>
                                    <label class="column-checkbox">
                                        <input type="checkbox" id="col-ca-ttc" checked> CA TTC
                                    </label>
                                </div>
                                
                                <div class="export-actions">
                                    <button class="btn btn-primary" onclick="exportCustom()">
                                        <i class="fas fa-file-excel"></i> Exporter Excel Personnalis√©
                                    </button>
                                    <button class="btn btn-secondary" onclick="previewExport()">
                                        <i class="fas fa-eye"></i> Pr√©visualiser
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-group">
                        <h3>Exports Rapides</h3>
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportQuick('current-year')">
                                <i class="fas fa-calendar"></i> Ann√©e Courante
                            </button>
                            <button class="export-btn" onclick="exportQuick('all-data')">
                                <i class="fas fa-database"></i> Toutes Donn√©es
                            </button>
                            <button class="export-btn secondary" onclick="exportQuick('summary')">
                                <i class="fas fa-chart-pie"></i> R√©sum√© Comptable
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal pour ajouter/√©diter un √©v√©nement -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Ajouter un √©v√©nement</h3>
                <button class="modal-close" onclick="closeEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="event-form">
                    <div class="form-tabs">
                        <button type="button" class="form-tab active" data-tab="general">G√©n√©ral</button>
                        <button type="button" class="form-tab" data-tab="participants">Participants</button>
                        <button type="button" class="form-tab" data-tab="recettes">Recettes</button>
                        <button type="button" class="form-tab" data-tab="consommation">Consommation</button>
                    </div>
                    
                    <!-- Onglet G√©n√©ral -->
                    <div class="form-tab-content active" id="tab-general">
                        <div class="form-group">
                            <label for="event-nom">Nom de l'√©v√©nement :</label>
                            <input type="text" id="event-nom" required>
                        </div>
                        <div class="form-group">
                            <label for="event-date">Date :</label>
                            <input type="date" id="event-date" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-heure-debut">Heure d√©but :</label>
                                <input type="time" id="event-heure-debut">
                            </div>
                            <div class="form-group">
                                <label for="event-heure-fin">Heure fin :</label>
                                <input type="time" id="event-heure-fin">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-type-soiree">Type de soir√©e :</label>
                            <select id="event-type-soiree">
                                <option value="">-- S√©lectionner --</option>
                                <option value="all-inclusive">üçπ All Inclusive</option>
                                <option value="formule-bar">üç∫ Formule Bar</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Onglet Participants -->
                    <div class="form-tab-content" id="tab-participants">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-participants">Participants payants :</label>
                                <input type="number" id="event-participants" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="event-presences-totales">Pr√©sences totales :</label>
                                <input type="number" id="event-presences-totales" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-presents-couple">Pr√©sents couple :</label>
                                <input type="number" id="event-presents-couple" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-presents-homme">Pr√©sents homme :</label>
                                <input type="number" id="event-presents-homme" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-presents-femme">Pr√©sents femme :</label>
                                <input type="number" id="event-presents-femme" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-renouvellement-carte">Renouvellement carte :</label>
                                <input type="number" id="event-renouvellement-carte" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Onglet Recettes -->
                    <div class="form-tab-content" id="tab-recettes">
                        <h4>Entr√©es</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-cash-entrees">Cash entr√©es (‚Ç¨) :</label>
                                <input type="number" id="event-cash-entrees" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-carte-entrees">Carte entr√©es (‚Ç¨) :</label>
                                <input type="number" id="event-carte-entrees" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-credit-entrees">Cr√©dit entr√©es (‚Ç¨) :</label>
                                <input type="number" id="event-credit-entrees" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-total-entrees">Total entr√©es (‚Ç¨) :</label>
                                <input type="number" id="event-total-entrees" step="0.01" min="0" readonly>
                            </div>
                        </div>
                        
                        <h4>Recharges</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-recharge-cash">Recharge Cash (‚Ç¨) :</label>
                                <input type="number" id="event-recharge-cash" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-recharge-credit">Recharge Cr√©dit (‚Ç¨) :</label>
                                <input type="number" id="event-recharge-credit" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-total-recharges">Total recharges (‚Ç¨) :</label>
                            <input type="number" id="event-total-recharges" step="0.01" min="0" readonly>
                        </div>
                        
                        <h4>Totaux</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-ca-ht">CA HT (‚Ç¨) :</label>
                                <input type="number" id="event-ca-ht" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="event-tva">TVA (‚Ç¨) :</label>
                                <input type="number" id="event-tva" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-ca-ttc">CA TTC (‚Ç¨) :</label>
                            <input type="number" id="event-ca-ttc" step="0.01" min="0" readonly>
                        </div>
                    </div>
                    
                    <!-- Onglet Consommation -->
                    <div class="form-tab-content" id="tab-consommation">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-quantite-snacks">Quantit√© snacks :</label>
                                <input type="number" id="event-quantite-snacks" min="0">
                            </div>
                            <div class="form-group">
                                <label for="event-consommation-nourriture">Consommation nourriture (‚Ç¨) :</label>
                                <input type="number" id="event-consommation-nourriture" step="0.01" min="0">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveEvent()">Enregistrer</button>
                <button class="btn btn-secondary" onclick="closeEventModal()">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal pour param√®tres de ventilation -->
    <div class="modal" id="ventilation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Param√®tres de Ventilation</h3>
                <button class="modal-close" onclick="closeVentilationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ventilation-form">
                    <div class="ventilation-settings">
                        <h4>üí∞ Tarifs d'Entr√©e</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tarif-couple">üë´ Tarif Couple :</label>
                                <input type="number" id="tarif-couple" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="tarif-femme">üë© Tarif Femme :</label>
                                <input type="number" id="tarif-femme" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="tarif-homme">üë® Tarif Homme :</label>
                            <input type="number" id="tarif-homme" min="0" step="0.01" required>
                        </div>

                        <h4>üç∫ Consommations</h4>
                        <div class="form-group">
                            <label for="prix-conso">Prix unitaire consommation :</label>
                            <input type="number" id="prix-conso" min="0" step="0.01" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nbr-conso-couple">üë´ Nbr Conso Couple :</label>
                                <input type="number" id="nbr-conso-couple" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="nbr-conso-femme">üë© Nbr Conso Femme :</label>
                                <input type="number" id="nbr-conso-femme" min="0" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nbr-conso-homme">üë® Nbr Conso Homme :</label>
                            <input type="number" id="nbr-conso-homme" min="0" required>
                        </div>

                        <h4>üìä Aper√ßu des Calculs</h4>
                        <div class="ventilation-preview">
                            <div class="preview-row">
                                <span>üë´ Couple:</span>
                                <span id="preview-couple">50‚Ç¨ - (9‚Ç¨ √ó 2) = 32‚Ç¨</span>
                            </div>
                            <div class="preview-row">
                                <span>üë© Femme:</span>
                                <span id="preview-femme">25‚Ç¨ - (9‚Ç¨ √ó 2) = 7‚Ç¨</span>
                            </div>
                            <div class="preview-row">
                                <span>üë® Homme:</span>
                                <span id="preview-homme">100‚Ç¨ - (9‚Ç¨ √ó 4) = 64‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="saveVentilationParams()">üíæ Sauvegarder</button>
                <button type="button" class="btn btn-warning" onclick="resetVentilationParams()">üîÑ R√©initialiser</button>
                <button type="button" class="btn btn-secondary" onclick="closeVentilationModal()">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDNhRtZLh8vzpUPBOLOPBjT9NXIOWi9QQg",
            authDomain: "staff-time-app.firebaseapp.com",
            projectId: "staff-time-app",
            storageBucket: "staff-time-app.firebasestorage.app",
            messagingSenderId: "771230361508",
            appId: "1:771230361508:web:98a84eb13557f45f4d4331"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make db available globally
        window.firebaseApp = app;
        window.firebaseDB = db;
        
        console.log('üî• Firebase initialized successfully!');
    </script>
    
    <script src="js/app.js" type="module"></script>
</body>
</html>